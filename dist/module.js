define(["@grafana/data","react","@emotion/css","@grafana/ui","d3"],((e,t,a,n,l)=>(()=>{"use strict";var r={7:e=>{e.exports=n},89:e=>{e.exports=a},201:e=>{e.exports=l},781:t=>{t.exports=e},959:e=>{e.exports=t}},s={};function i(e){var t=s[e];if(void 0!==t)return t.exports;var a=s[e]={exports:{}};return r[e](a,a.exports,i),a.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};i.r(o),i.d(o,{plugin:()=>y});var c=i(781),d=i(959),u=i.n(d),p=i(89),m=i(7),g=i(201);const f=(e,t,a)=>{const n=t-e,l=Math.ceil(n/a);return Array.from({length:l},((t,n)=>[e+n*a,e+(n+1)*a]))},h=(e,t,a=0)=>{if(null===e)return console.log("Unexpected value is null"),null;if(!Array.isArray(t[0]))return null;if(e<t[0][0])return null;const n=t.length,l=t[n-1];e>=l[1]&&(e-=a);for(let a=0;a<n;a++){const[n,l]=t[a];if(e>=n&&e<l)return a}return e===l[1]?n-1:(console.warn(`getIntervalIndex ${e} too big`),null)},y=new c.PanelPlugin((({options:e,data:t,width:a,height:n})=>{const l=(0,m.useTheme2)(),r=(0,m.useStyles2)((()=>((e,t)=>({wrapper:(0,p.css)({position:"relative"}),svg:p.css`
      position: absolute;
      top: 0;
      left: 0;
    `,zLabel:(0,p.css)({fontSize:`${t.legendFontSize}px`}),speedLabel:(0,p.css)({fontSize:`${t.speedFontSize}px`}),directionLabel:(0,p.css)({fontSize:`${t.directionFontSize}px`}),axis:(0,p.css)({opacity:.7})}))(0,e)));let s,i;if(0===t.series.length)throw new Error("Minimum of 1 series required");if(1===t.series.length){var o,y;const e=t.series[0].fields;s=(null===(o=e.find(((e,t)=>"speed"===e.name)))||void 0===o?void 0:o.values)||[],i=(null===(y=e.find(((e,t)=>"direction"===e.name)))||void 0===y?void 0:y.values)||[]}else{const e=t.series.find(((e,t)=>{e.fields.some((e=>"speed"===e.name))}))||t.series[0],a=t.series.find(((e,t)=>{e.fields.some((e=>"direction"===e.name))}))||t.series[1];s=e.fields[1].values,i=a.fields[1].values}const x=s.length>0?Math.max(...s):0,S=i.map(((e,t)=>[e,s[t]])).filter((([e,t])=>null!=t)),v=+e.slices,b=+e.start,E=""===e.step?Math.ceil(x/8):+parseInt(e.step,10),w=e.unit,z=360/v,k=f(-z/2,360-z/2,z),$=f(b,x,E),F=[...Array(k.length)].map((e=>Array($.length).fill(0)));for(let e=0;e<S.length;e++){let t=h(S[e][0],k,360),a=h(S[e][1],$);null!=t&&null!=a&&F[t][a]++}const A=$.map((e=>e[0]+" - "+e[1])),I=[];for(let e=0;e<k.length;e++){const t={angle:k[e][0]};let a=0;for(let n=0;n<$.length;n++)a+=t[A[n]]=F[e][n];t.total=a,I.push(t)}if("percent"===e.scale){const e=g.sum(I,(e=>e.total)),t=g.scaleLinear([0,e],[0,1]);for(let e=0;e<I.length;e++)for(let a in I[e])"angle"!==a&&(I[e][a]=t(I[e][a]))}const N=a-40-40,L=n-40-40,V=Math.min(N,L)/2,P=[0,V],M=[0,2*Math.PI],O=g.scaleLinear([0,360],M),R=g.max(I,(e=>e.total))||0,D=g.scaleLinear([0,R],P),_=g.scaleOrdinal(A,["#4242f4","#42c5f4","#42f4ce","#42f456","#adf442","#f4e242","#f4a142","#f44242"]),B=g.scaleBand(I.map((e=>e.angle)),M).align(0).bandwidth(),j=((e,t,a=1)=>{const n=[];if(void 0===t&&(t=e,e=0),e<t&&a<=0||e>t&&a>=0)throw new Error("Step value causes infinite loop");if(e<t)for(let l=e;l<t;l+=a)n.push(l);else for(let l=e;l>t;l+=a)n.push(l);return n})(0,360,45),T=g.scaleLinear([0,8],M),G=g.scaleBand(j,M).align(0).bandwidth(),U=-360/j.length/2,W={0:"N",45:"NE",90:"E",135:"SE",180:"S",225:"SW",270:"W",315:"NW"},q=(0,c.getValueFormat)(w),C=g.scaleLinear([0,g.max(j,(e=>e))||0],P),X=({transform:e})=>{const t=(0,d.useRef)(null);return(0,d.useEffect)((()=>{if(t.current){const e=g.axisLeft(C).scale(C.copy().range([-0,-(V+10)])).ticks(0);g.select(t.current).call(e)}}),[e]),u().createElement("g",{ref:t,transform:e,className:r.axis})};return(0,d.useEffect)((()=>{const e=document.querySelector(".legend-group");if(e instanceof SVGGElement){const t=e.getBBox().width,n=a/2-t;e.setAttribute("transform",`translate(${n}, 0)`)}}),[a,A,e.legendFontSize,e.speedFontSize,e.directionFontSize]),u().createElement("div",{className:(0,p.cx)(r.wrapper,p.css`
          width: ${a}px;
          height: ${n}px;
        `)},u().createElement("svg",{className:r.svg,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:`-${a/2} -${n/2} ${a} ${n}`,width:a,height:n},u().createElement("g",null,g.stack().keys(A)(I).map(((t,a)=>u().createElement("g",{key:a,fill:_(t.key),fillOpacity:e.opacity},t.map(((e,t)=>{var a;const n={innerRadius:D(e[0]),outerRadius:D(e[1]),startAngle:O(e.data.angle),endAngle:O(e.data.angle)+B};var l;return u().createElement("path",{key:t,d:null!==(l=null===(a=g.arc().innerRadius((()=>D(e[0]))).outerRadius((()=>D(e[1]))).startAngle((()=>O(e.data.angle))).endAngle((()=>O(e.data.angle)+B)).padAngle(.01).padRadius(0)(n))||void 0===a?void 0:a.toString())&&void 0!==l?l:void 0})}))))),j.map(((t,a)=>{var n;return u().createElement("g",{key:a,textAnchor:"middle",transform:`rotate(${180*(O(t)+G/2)/Math.PI-(90-U)})translate(${V+30},0)`},u().createElement("text",{transform:`rotate(${90-t})`,fill:l.colors.text.secondary,className:r.directionLabel},"compass"===e.x_grid&&null!==(n=W[t])&&void 0!==n?n:t))})),u().createElement("g",{className:"axis"},g.range(T.domain()[1]).map(((e,t)=>u().createElement("g",{key:t,className:"axis"},u().createElement(X,{key:t,transform:`rotate(${180*T(e)/Math.PI})`}))))),u().createElement("g",{textAnchor:"middle"},D.ticks(e.rings).slice(1).map(((t,a)=>u().createElement("g",{key:a},u().createElement("circle",{fill:"none",stroke:l.colors.border.strong,strokeDasharray:"4,4",r:D(t)}),u().createElement("text",{y:-D(t),dy:"-0.35em",x:-10,fill:l.colors.text.secondary,className:r.speedLabel},D.tickFormat(5,"percent"===e.scale?"%":"s")(t)))))),u().createElement("g",{className:"legend-group"},A.slice().reverse().map(((e,t)=>u().createElement("g",{key:t,transform:`translate(0, ${40-n/2+20*(t-A.length/2)})`},u().createElement("rect",{width:18,height:18,fill:_(e)}),u().createElement("text",{x:24,y:9,dy:"0.35em",fill:l.colors.text.primary,className:r.zLabel},`${e}${q(t).suffix}`))))))))})).setPanelOptions((e=>e.addSliderInput({category:["Display"],path:"opacity",name:"Opacity",settings:{min:0,max:1,step:.05},defaultValue:.6}).addNumberInput({category:["Direction"],path:"slices",name:"Cake slices",settings:{min:1,integer:!0},defaultValue:32}).addRadio({category:["Direction"],path:"x_grid",name:"Grid labels",defaultValue:"degrees",settings:{options:[{value:"degrees",label:"Degrees"},{value:"compass",label:"Compass"}]}}).addSliderInput({category:["Speed"],path:"rings",name:"Rings",settings:{min:1,max:16,integer:!0},defaultValue:5}).addNumberInput({category:["Speed"],path:"start",name:"Start",settings:{min:0},defaultValue:0}).addTextInput({category:["Speed"],path:"step",name:"Step",defaultValue:""}).addUnitPicker({category:["Speed"],path:"unit",name:"Unit",defaultValue:"velocityms"}).addRadio({category:["Speed"],path:"scale",name:"Scale",defaultValue:"absolute",settings:{options:[{value:"absolute",label:"Absolute"},{value:"percent",label:"Percent"}]}}).addSliderInput({category:["Font Sizes"],path:"legendFontSize",name:"Legend Font Size",settings:{min:8,max:16,step:1},defaultValue:12}).addSliderInput({category:["Font Sizes"],path:"speedFontSize",name:"Speed Font Size",settings:{min:8,max:16,step:1},defaultValue:14}).addSliderInput({category:["Font Sizes"],path:"directionFontSize",name:"Direction Font Size",settings:{min:8,max:16,step:1},defaultValue:14})));return o})()));
//# sourceMappingURL=module.js.map