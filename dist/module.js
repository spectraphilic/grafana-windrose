define(["@grafana/data","react","@emotion/css","@grafana/ui","d3"],((e,t,a,r,l)=>(()=>{"use strict";var n={89:e=>{e.exports=a},781:t=>{t.exports=e},7:e=>{e.exports=r},201:e=>{e.exports=l},959:e=>{e.exports=t}},s={};function i(e){var t=s[e];if(void 0!==t)return t.exports;var a=s[e]={exports:{}};return n[e](a,a.exports,i),a.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};i.r(o),i.d(o,{plugin:()=>x});var c=i(781),d=i(959),u=i.n(d),p=i(89),m=i(7),g=i(201);const f=e=>({wrapper:(0,p.css)({position:"relative"}),svg:p.css`
      position: absolute;
      top: 0;
      left: 0;
    `,zLabel:(0,p.css)({fontSize:"12px"}),speedLabel:(0,p.css)({fontSize:"14px"}),directionLabel:(0,p.css)({fontSize:"14px"}),axis:(0,p.css)({opacity:.7})}),h=(e,t,a)=>{const r=t-e,l=Math.ceil(r/a);return Array.from({length:l},((t,r)=>[e+r*a,e+(r+1)*a]))},y=(e,t,a=0)=>{if(null===e)return console.log("Unexpected value is null"),null;if(!Array.isArray(t[0]))return null;if(e<t[0][0])return null;const r=t.length,l=t[r-1];e>=l[1]&&(e-=a);for(let a=0;a<r;a++){const[r,l]=t[a];if(e>=r&&e<l)return a}return e===l[1]?r-1:(console.warn(`getIntervalIndex ${e} too big`),null)},x=new c.PanelPlugin((({options:e,data:t,width:a,height:r})=>{const l=(0,m.useTheme2)(),n=(0,m.useStyles2)(f);if(t.series.length<2)throw new Error("Minimum of 2 series required");const s=t.series.find(((e,t)=>{e.fields.some((e=>"speed"===e.name))}))||t.series[0],i=t.series.find(((e,t)=>{e.fields.some((e=>"direction"===e.name))}))||t.series[1],o=s.fields[1].values,x=i.fields[1].values,v=o.length>0?Math.max(...o):0,b=x.map(((e,t)=>[e,o[t]])).filter((([e,t])=>null!=t)),w=+e.slices,E=+e.start,S=""===e.step?Math.ceil(v/8):+parseInt(e.step,10),k=e.unit,$=360/w,A=h(-$/2,360-$/2,$),N=h(E,v,S),L=[...Array(A.length)].map((e=>Array(N.length).fill(0)));for(let e=0;e<b.length;e++){let t=y(b[e][0],A,360),a=y(b[e][1],N);null!=t&&null!=a&&L[t][a]++}const P=N.map((e=>e[0]+" - "+e[1])),I=[];for(let e=0;e<A.length;e++){const t={angle:A[e][0]};let a=0;for(let r=0;r<N.length;r++)a+=t[P[r]]=L[e][r];t.total=a,I.push(t)}if("percent"===e.scale){const e=g.sum(I,(e=>e.total)),t=g.scaleLinear([0,e],[0,1]);for(let e=0;e<I.length;e++)for(let a in I[e])"angle"!==a&&(I[e][a]=t(I[e][a]))}const M=a-40-80,O=r-40-40,R=Math.min(M,O)/2,V=[0,R],_=[0,2*Math.PI],z=g.scaleLinear([0,360],_),D=g.max(I,(e=>e.total))||0,j=g.scaleLinear([0,D],V),T=g.scaleOrdinal(P,["#4242f4","#42c5f4","#42f4ce","#42f456","#adf442","#f4e242","#f4a142","#f44242"]),B=g.scaleBand(I.map((e=>e.angle)),_).align(0).bandwidth(),U=((e,t,a=1)=>{const r=[];if(void 0===t&&(t=e,e=0),e<t&&a<=0||e>t&&a>=0)throw new Error("Step value causes infinite loop");if(e<t)for(let l=e;l<t;l+=a)r.push(l);else for(let l=e;l>t;l+=a)r.push(l);return r})(0,360,45),W=g.scaleLinear([0,8],_),C=g.scaleBand(U,_).align(0).bandwidth(),F=-360/U.length/2,q={0:"N",45:"NE",90:"E",135:"SE",180:"S",225:"SW",270:"W",315:"NW"},G=(0,c.getValueFormat)(k),X=g.scaleLinear([0,g.max(U,(e=>e))||0],V),H=({transform:e})=>{const t=(0,d.useRef)(null);return(0,d.useEffect)((()=>{if(t.current){const e=g.axisLeft(X).scale(X.copy().range([-0,-(R+10)])).ticks(0);g.select(t.current).call(e)}}),[e]),u().createElement("g",{ref:t,transform:e,className:n.axis})};return u().createElement("div",{className:(0,p.cx)(n.wrapper,p.css`
          width: ${a}px;
          height: ${r}px;
        `)},u().createElement("svg",{className:n.svg,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:`-${a/2} -${r/2} ${a} ${r}`,width:a,height:r},u().createElement("g",null,g.stack().keys(P)(I).map(((t,a)=>u().createElement("g",{key:a,fill:T(t.key),fillOpacity:e.opacity},t.map(((e,t)=>{var a;const r={innerRadius:j(e[0]),outerRadius:j(e[1]),startAngle:z(e.data.angle),endAngle:z(e.data.angle)+B};var l;return u().createElement("path",{key:t,d:null!==(l=null===(a=g.arc().innerRadius((()=>j(e[0]))).outerRadius((()=>j(e[1]))).startAngle((()=>z(e.data.angle))).endAngle((()=>z(e.data.angle)+B)).padAngle(.01).padRadius(0)(r))||void 0===a?void 0:a.toString())&&void 0!==l?l:void 0})}))))),U.map(((t,a)=>{var r;return u().createElement("g",{key:a,textAnchor:"middle",transform:`rotate(${180*(z(t)+C/2)/Math.PI-(90-F)})translate(${R+30},0)`},u().createElement("text",{transform:`rotate(${90-t})`,fill:l.colors.text.secondary,className:n.directionLabel},"compass"===e.x_grid&&null!==(r=q[t])&&void 0!==r?r:t))})),u().createElement("g",{className:"axis"},g.range(W.domain()[1]).map(((e,t)=>u().createElement("g",{key:t,className:"axis"},u().createElement(H,{key:t,transform:`rotate(${180*W(e)/Math.PI})`}))))),u().createElement("g",{textAnchor:"middle"},j.ticks(e.rings).slice(1).map(((t,a)=>u().createElement("g",{key:a},u().createElement("circle",{fill:"none",stroke:l.colors.border.strong,strokeDasharray:"4,4",r:j(t)}),u().createElement("text",{y:-j(t),dy:"-0.35em",x:-10,fill:l.colors.text.secondary,className:n.speedLabel},j.tickFormat(5,"percent"===e.scale?"%":"s")(t)))))),P.slice().reverse().map(((e,t)=>u().createElement("g",{key:t,transform:`translate(${R+30}, ${40-R+20*(t-P.length/2)})`},u().createElement("rect",{width:18,height:18,fill:T(e)}),u().createElement("text",{x:24,y:9,dy:"0.35em",fill:l.colors.text.primary,className:n.zLabel},`${e}${G(t).suffix}`)))))))})).setPanelOptions((e=>e.addSliderInput({category:["Display"],path:"opacity",name:"Opacity",settings:{min:0,max:1,step:.05},defaultValue:.6}).addNumberInput({category:["Direction"],path:"slices",name:"Cake slices",settings:{min:1,integer:!0},defaultValue:32}).addRadio({category:["Direction"],path:"x_grid",name:"Grid labels",defaultValue:"degrees",settings:{options:[{value:"degrees",label:"Degrees"},{value:"compass",label:"Compass"}]}}).addSliderInput({category:["Speed"],path:"rings",name:"Rings",settings:{min:1,max:16,integer:!0},defaultValue:5}).addNumberInput({category:["Speed"],path:"start",name:"Start",settings:{min:0},defaultValue:0}).addTextInput({category:["Speed"],path:"step",name:"Step",defaultValue:""}).addUnitPicker({category:["Speed"],path:"unit",name:"Unit",defaultValue:"velocityms"}).addRadio({category:["Speed"],path:"scale",name:"Scale",defaultValue:"absolute",settings:{options:[{value:"absolute",label:"Absolute"},{value:"percent",label:"Percent"}]}})));return o})()));
//# sourceMappingURL=module.js.map