define(["@grafana/data","react","@emotion/css","@grafana/ui","d3"],(e,t,a,n,l)=>(()=>{"use strict";var r={7:e=>{e.exports=n},89:e=>{e.exports=a},201:e=>{e.exports=l},781:t=>{t.exports=e},959:e=>{e.exports=t}},s={};function i(e){var t=s[e];if(void 0!==t)return t.exports;var a=s[e]={exports:{}};return r[e](a,a.exports,i),a.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};i.r(o),i.d(o,{plugin:()=>y});var d=i(781),c=i(959),u=i.n(c),m=i(89),p=i(7),g=i(201);const f=(e,t,a)=>{const n=t-e,l=Math.ceil(n/a);return Array.from({length:l},(t,n)=>[e+n*a,e+(n+1)*a])},h=(e,t,a=0)=>{if(null===e)return console.log("Unexpected value is null"),null;if(!Array.isArray(t[0]))return null;if(e<t[0][0])return null;const n=t.length,l=t[n-1];e>=l[1]&&(e-=a);for(let a=0;a<n;a++){const[n,l]=t[a];if(e>=n&&e<l)return a}return e===l[1]?n-1:(console.warn(`getIntervalIndex ${e} too big`),null)},y=new d.PanelPlugin(({options:e,data:t,width:a,height:n})=>{const l=(0,p.useTheme2)(),r=(0,p.useStyles2)(()=>((e,t)=>({wrapper:(0,m.css)({position:"relative"}),svg:m.css`
      position: absolute;
      top: 0;
      left: 0;
    `,zLabel:(0,m.css)({fontSize:`${t.legendFontSize}px`}),speedLabel:(0,m.css)({fontSize:`${t.speedFontSize}px`}),directionLabel:(0,m.css)({fontSize:`${t.directionFontSize}px`}),axis:(0,m.css)({opacity:.7})}))(0,e));let s,i;if(0===t.series.length)throw new Error("Minimum of 1 series required");if(1===t.series.length){var o,y;const e=t.series[0].fields;s=(null===(o=e.find((e,t)=>"speed"===e.name))||void 0===o?void 0:o.values)||[],i=(null===(y=e.find((e,t)=>"direction"===e.name))||void 0===y?void 0:y.values)||[]}else{const e=t.series.find((e,t)=>{e.fields.some(e=>"speed"===e.name)})||t.series[0],a=t.series.find((e,t)=>{e.fields.some(e=>"direction"===e.name)})||t.series[1];s=e.fields[1].values,i=a.fields[1].values}const v=s.length>0?Math.max(...s):0,x=i.map((e,t)=>[e,s[t]]).filter(([e,t])=>null!=t),S=+e.slices,b=+e.start,w=""===e.step?Math.ceil(v/8):+parseInt(e.step,10),E=e.unit,$=360/S,k=f(-$/2,360-$/2,$),A=f(b,v,w),z=[...Array(k.length)].map(e=>Array(A.length).fill(0));for(let e=0;e<x.length;e++){let t=h(x[e][0],k,360),a=h(x[e][1],A);null!=t&&null!=a&&z[t][a]++}const F=A.map(e=>e[0]+" - "+e[1]),I=[];for(let e=0;e<k.length;e++){const t={angle:k[e][0]};let a=0;for(let n=0;n<A.length;n++)a+=t[F[n]]=z[e][n];t.total=a,I.push(t)}if("percent"===e.scale){const e=g.sum(I,e=>e.total),t=g.scaleLinear([0,e],[0,1]);for(let e=0;e<I.length;e++)for(let a in I[e])"angle"!==a&&(I[e][a]=t(I[e][a]))}const L=u().useMemo(()=>({top:40,right:40,bottom:40,left:40}),[]),N=a-L.left-L.right,V=n-L.top-L.bottom,M=Math.min(N,V)/2,P=[0,M],R=[0,2*Math.PI],O=g.scaleLinear([0,360],R),B=g.max(I,e=>e.total)||0,D=g.scaleLinear([0,B],P),_=g.scaleOrdinal(F,["#4242f4","#42c5f4","#42f4ce","#42f456","#adf442","#f4e242","#f4a142","#f44242"]),T=g.scaleBand(I.map(e=>e.angle),R).align(0).bandwidth(),j=((e,t,a=1)=>{const n=[];if(void 0===t&&(t=e,e=0),e<t&&a<=0||e>t&&a>=0)throw new Error("Step value causes infinite loop");if(e<t)for(let l=e;l<t;l+=a)n.push(l);else for(let l=e;l>t;l+=a)n.push(l);return n})(0,360,45),W=g.scaleLinear([0,8],R),C=g.scaleBand(j,R).align(0).bandwidth(),G=-360/j.length/2,U={0:"N",45:"NE",90:"E",135:"SE",180:"S",225:"SW",270:"W",315:"NW"},q=(0,d.getValueFormat)(E),X=g.scaleLinear([0,g.max(j,e=>e)||0],P),H=({transform:e})=>{const t=(0,c.useRef)(null);return(0,c.useEffect)(()=>{if(t.current){const e=g.axisLeft(X).scale(X.copy().range([-0,-(M+10)])).ticks(0);g.select(t.current).call(e)}},[e]),u().createElement("g",{ref:t,transform:e,className:r.axis})},J=(()=>{switch(e.windroseAlignment){case"left":return`translate(${-a/2+M+L.left}, 0)`;case"top":return`translate(0, ${-n/2+M+L.top})`;case"bottom":return`translate(0, ${n/2-M-L.bottom})`;default:return"translate(0, 0)"}})(),[K,Q]=u().useState(void 0);return u().useEffect(()=>{const t=document.querySelector(".legend-group");if(!(t instanceof SVGGElement))return;const l=t.getBBox(),r=l.width,s=l.height;let i;switch(e.windroseAlignment){case"top":i=`translate(${-r/2}, ${n/2-s})`;break;case"bottom":i=`translate(${-r/2}, ${-n/2+L.top})`;break;default:i=`translate(${a/2-r}, ${-n/2+L.top})`}Q(i)},[a,n,L,M,e.windroseAlignment,e.legendFontSize,F]),u().createElement("div",{className:(0,m.cx)(r.wrapper,m.css`
          width: ${a}px;
          height: ${n}px;
        `)},u().createElement("svg",{className:r.svg,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:`-${a/2} -${n/2} ${a} ${n}`,width:a,height:n},u().createElement("g",{transform:J},g.stack().keys(F)(I).map((t,a)=>u().createElement("g",{key:a,fill:_(t.key),fillOpacity:e.opacity},t.map((e,t)=>{var a;const n={innerRadius:D(e[0]),outerRadius:D(e[1]),startAngle:O(e.data.angle),endAngle:O(e.data.angle)+T};var l;return u().createElement("path",{key:t,d:null!==(l=null===(a=g.arc().innerRadius(()=>D(e[0])).outerRadius(()=>D(e[1])).startAngle(()=>O(e.data.angle)).endAngle(()=>O(e.data.angle)+T).padAngle(.01).padRadius(0)(n))||void 0===a?void 0:a.toString())&&void 0!==l?l:void 0})}))),j.map((t,a)=>{var n;return u().createElement("g",{key:a,textAnchor:"middle",transform:`rotate(${180*(O(t)+C/2)/Math.PI-(90-G)})translate(${M+30},0)`},u().createElement("text",{transform:`rotate(${90-t})`,fill:l.colors.text.secondary,className:r.directionLabel},"compass"===e.x_grid&&null!==(n=U[t])&&void 0!==n?n:t))}),u().createElement("g",{className:"axis"},g.range(W.domain()[1]).map((e,t)=>u().createElement("g",{key:t,className:"axis"},u().createElement(H,{key:t,transform:`rotate(${180*W(e)/Math.PI})`})))),u().createElement("g",{textAnchor:"middle"},D.ticks(e.rings).slice(1).map((t,a)=>u().createElement("g",{key:a},u().createElement("circle",{fill:"none",stroke:l.colors.border.strong,strokeDasharray:"4,4",r:D(t)}),u().createElement("text",{y:-D(t),dy:"-0.35em",x:-10,fill:l.colors.text.secondary,className:r.speedLabel},D.tickFormat(5,"percent"===e.scale?"%":"s")(t)))))),u().createElement("g",{className:"legend-group",transform:K},F.slice().reverse().map((e,t)=>u().createElement("g",{key:t,transform:`translate(0, ${20*t})`},u().createElement("rect",{width:18,height:18,fill:_(e)}),u().createElement("text",{x:24,y:9,dy:"0.35em",fill:l.colors.text.primary,className:r.zLabel},`${e}${q(t).suffix}`))))))}).setPanelOptions(e=>e.addSliderInput({category:["Display"],path:"opacity",name:"Opacity",settings:{min:0,max:1,step:.05},defaultValue:.6}).addNumberInput({category:["Direction"],path:"slices",name:"Cake slices",settings:{min:1,integer:!0},defaultValue:32}).addRadio({category:["Direction"],path:"x_grid",name:"Grid labels",defaultValue:"degrees",settings:{options:[{value:"degrees",label:"Degrees"},{value:"compass",label:"Compass"}]}}).addSliderInput({category:["Speed"],path:"rings",name:"Rings",settings:{min:1,max:16,integer:!0},defaultValue:5}).addNumberInput({category:["Speed"],path:"start",name:"Start",settings:{min:0},defaultValue:0}).addTextInput({category:["Speed"],path:"step",name:"Step",defaultValue:""}).addUnitPicker({category:["Speed"],path:"unit",name:"Unit",defaultValue:"velocityms"}).addRadio({category:["Speed"],path:"scale",name:"Scale",defaultValue:"absolute",settings:{options:[{value:"absolute",label:"Absolute"},{value:"percent",label:"Percent"}]}}).addRadio({category:["Alignment"],path:"windroseAlignment",name:"Windrose Alignment",defaultValue:"center",settings:{options:[{value:"center",label:"Center"},{value:"left",label:"Left"},{value:"top",label:"Top"},{value:"bottom",label:"Bottom"}]}}).addSliderInput({category:["Font Sizes"],path:"legendFontSize",name:"Legend Font Size",settings:{min:8,max:16,step:1},defaultValue:12}).addSliderInput({category:["Font Sizes"],path:"speedFontSize",name:"Speed Font Size",settings:{min:8,max:16,step:1},defaultValue:14}).addSliderInput({category:["Font Sizes"],path:"directionFontSize",name:"Direction Font Size",settings:{min:8,max:16,step:1},defaultValue:14}));return o})());
//# sourceMappingURL=module.js.map